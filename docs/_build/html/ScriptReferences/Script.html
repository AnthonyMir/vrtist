<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Script References &mdash; VRtist v0.1.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/VrTist_logo.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Camera Montage &amp; Editing" href="../Advanced/Montage.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> VRtist
            <img src="../_static/VrTist_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Start/GettingStarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Start/Link.html">Live Link with Blender</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Basics/Basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Basics/Movements.html">Movements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Basics/Settings.html">Settings</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Tools/Palette.html">Palette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/Selection.html">Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/Painting.html">Painting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/Lighting.html">Lighting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/Camera.html">Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/Material.html">Material</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/AssetBank.html">AssetBank</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/Skybox.html">Skybox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/Gun.html">Gun</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Advanced/Animation.html">Animation Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Advanced/Montage.html">Camera Montage &amp; Editing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Script References</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Script References</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tools">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="#animation-engine">Animation engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="#commands">Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#imports">Imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="#movable-objects">Movable objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#inputs">Inputs</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VRtist</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Script References</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="script-references">
<h1>Script References<a class="headerlink" href="#script-references" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<div class="line-block">
<div class="line">VRtist is centered around three main static classes:</div>
<div class="line">Global State for the core. It has references for settings, player controllers and animation engine.</div>
<div class="line">Tools Manager for the tools themselves, mostly getting and changing active tools.</div>
<div class="line">Scene Manager which contains many static methods to interact with the content of the scene.</div>
<div class="line"><br /></div>
<div class="line">For project wide interaction that could impact various parts of the project, (ie: added objects, selection changes…) UnityEvents are used. Most of these events are in the Global State.</div>
<div class="line"><br /></div>
</div>
<img alt="../_images/Diagrame.png" class="no-scaled-link align-center" src="../_images/Diagrame.png" style="width: 700px;" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="tools">
<h2>Tools<a class="headerlink" href="#tools" title="Permalink to this headline"></a></h2>
<div class="line-block">
<div class="line">Tools are managed by two static classes:</div>
<div class="line">Tool Manager for the logic part, referencing all available tools and switching between them.</div>
<div class="line">Tool UI Manager for the User interface part.</div>
<div class="line"><br /></div>
<div class="line">All tools inherit from the ToolBase class.</div>
<div class="line">The tool base class registers the tool in the Tool Manager.</div>
<div class="line">The base class also implements methods for interface interaction (slider, buttons…)</div>
<div class="line">Tool base also implements DoUpdate and UpdateUI for tools that need to be manually updated.</div>
<div class="line">Tools that use selection must inherit from SelectorBase instead of ToolBase.</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line">For the interface:</div>
<div class="line">Tool Icons use the UIButton script. They are placed in CameraRig/Pivot/PaletteController/Palette/MainPanel.</div>
<div class="line">They use the OnReleaseEvents to call ToolsUIManager.ChangeTool and ToolsUIManager.ChangeTab with the name of the tool and ToolsUIManager.ShowColorPanel with whether it should show the color picker panel.</div>
<div class="line"><br /></div>
</div>
<img alt="../_images/UIButtonEvents.png" class="no-scaled-link align-center" src="../_images/UIButtonEvents.png" style="width: 300px;" />
<div class="line-block">
<div class="line"><br /></div>
<div class="line">The tool panel is placed in CameraRig/Pivot/PaletteController/Palette/MainPanel/ToolsPanelGroup and contains the UIPanel Script.</div>
<div class="line"><br /></div>
<div class="line">For the interaction:</div>
<div class="line">The tool script itself is in CameraRig/Pivot/ToolsController/Tools and the object name is the same that is called in ToolsUIManager.ChangeTool</div>
<div class="line"><br /></div>
</div>
</section>
<section id="animation-engine">
<h2>Animation engine<a class="headerlink" href="#animation-engine" title="Permalink to this headline"></a></h2>
<div class="line-block">
<div class="line">The animation Engine class stores and manages all animations in the scene.</div>
<div class="line"><br /></div>
<div class="line">An animation is represented by an animation set.</div>
<div class="line">An animation set contains the transform of the animated object and a dictionary of animatable properties with their curves.</div>
<div class="line">A curve is represented by a list of animation keys (frame, value, interpolation type).</div>
<div class="line">The curve contains a cache of its values for each frame. When the curve is modified (ie: a keyframe is added or removed) the curve will recalculate it’s cache.</div>
<div class="line"><br /></div>
<div class="line">When the current frame is changed, the animation engine will evaluate every animated object. To do so, for each animation set, it will read the value cached in the curves for the frame, and apply it to the property defined by this curve.</div>
<div class="line"><br /></div>
<div class="line">The animation engine subscribes to two events from Global state. When an object is added to the scene, it will check if that object had a previous animation, and if so compute it’s curves cache. When an object is removed from the scene, it will store the animation set, but free it’s curves cache.</div>
<div class="line"><br /></div>
<div class="line">Animation curves are drawn by the Animation3DCurveManager by reading the cached values of position curves.</div>
<div class="line"><br /></div>
</div>
</section>
<section id="commands">
<h2>Commands<a class="headerlink" href="#commands" title="Permalink to this headline"></a></h2>
<div class="line-block">
<div class="line">Every action in VRtist herits from the ICommand class.</div>
<div class="line">This allows actions to be undone or redone.</div>
<div class="line"><br /></div>
<div class="line">An action has to implement three methods:</div>
<div class="line">Redo: the operations done to apply the action.</div>
</div>
<div class="highlight-c# notranslate"><div class="highlight"><pre><span></span><span class="linenos">84</span><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Undo</span><span class="p">()</span>
<span class="linenos">85</span><span class="p">{</span>
<span class="linenos">86</span>    <span class="kt">int</span> <span class="n">count</span> <span class="p">=</span> <span class="n">objects</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span>
<span class="linenos">87</span>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
<span class="linenos">88</span>    <span class="p">{</span>
<span class="linenos">89</span>        <span class="n">GameObject</span> <span class="n">ob</span> <span class="p">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="linenos">90</span>        <span class="n">SceneManager</span><span class="p">.</span><span class="n">SetObjectTransform</span><span class="p">(</span><span class="n">ob</span><span class="p">,</span> <span class="n">beginPositions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">beginRotations</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">beginScales</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">91</span>    <span class="p">}</span>
<span class="linenos">92</span><span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">Undo: the operations done to undo the action.</div>
</div>
<div class="highlight-c# notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 93</span><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Redo</span><span class="p">()</span>
<span class="linenos"> 94</span><span class="p">{</span>
<span class="linenos"> 95</span>    <span class="kt">int</span> <span class="n">count</span> <span class="p">=</span> <span class="n">objects</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span>
<span class="linenos"> 96</span>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
<span class="linenos"> 97</span>    <span class="p">{</span>
<span class="linenos"> 98</span>        <span class="n">GameObject</span> <span class="n">ob</span> <span class="p">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="linenos"> 99</span>        <span class="n">SceneManager</span><span class="p">.</span><span class="n">SetObjectTransform</span><span class="p">(</span><span class="n">ob</span><span class="p">,</span> <span class="n">endPositions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">endRotations</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">endScales</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">100</span>    <span class="p">}</span>
<span class="linenos">101</span><span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">Submit: Calls redo a first time, and register the action in the CommandManager.</div>
</div>
<div class="highlight-c# notranslate"><div class="highlight"><pre><span></span><span class="linenos">102</span><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Submit</span><span class="p">()</span>
<span class="linenos">103</span><span class="p">{</span>
<span class="linenos">104</span>    <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">objects</span> <span class="p">&amp;&amp;</span> <span class="n">objects</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
<span class="linenos">105</span>    <span class="p">{</span>
<span class="linenos">106</span>        <span class="n">Redo</span><span class="p">();</span>
<span class="linenos">107</span>        <span class="n">CommandManager</span><span class="p">.</span><span class="n">AddCommand</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="linenos">108</span>    <span class="p">}</span>
<span class="linenos">109</span><span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">Command operations go through the scene manager.</div>
</div>
<div class="highlight-c# notranslate"><div class="highlight"><pre><span></span><span class="linenos">65</span><span class="k">static</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ICommand</span><span class="p">&gt;</span> <span class="n">undoStack</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ICommand</span><span class="p">&gt;();</span>
<span class="linenos">66</span><span class="k">static</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ICommand</span><span class="p">&gt;</span> <span class="n">redoStack</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ICommand</span><span class="p">&gt;();</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">When the action is done the first time, a command is created to store the state before and after the action. Then submit is called on that action.</div>
<div class="line">When the action is registered in the Command manager, it’s placed at the top of the command stack.</div>
<div class="line">When the user undoes an action, the Command manager calls the undo method on that action and moves it to the top of the redo stack.</div>
<div class="line">When the user redo an action, the Command manager calls the redo method on that action and moves it to the top of the undo stack.</div>
</div>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline"></a></h2>
<div class="line-block">
<div class="line">Importation of assets into VRtist is done using the Open Asset Import Library (Assimp).</div>
<div class="line">Asset importation is done over multiple frames to avoid freezes.</div>
<div class="line"><br /></div>
<div class="line">Assets importation takes the following steps:</div>
<div class="line">First the file is imported with assimp to create an Assimp scene.</div>
<div class="line">Then materials are read from the assimp scene and recreated with Unity materials.</div>
<div class="line">Then meshes are read and recreated in Unity.</div>
<div class="line">A root GameObject is created.</div>
<div class="line">Finally the hierarchy is recreated and meshes and materials are applied to each object.</div>
</div>
</section>
<section id="movable-objects">
<h2>Movable objects<a class="headerlink" href="#movable-objects" title="Permalink to this headline"></a></h2>
<div class="line-block">
<div class="line">For an object to be movable it must have a collider set as trigger and be tagged as “PhysicObject”. Object collision detection with the controller is done in SelectorTrigger.</div>
</div>
</section>
<section id="inputs">
<h2>Inputs<a class="headerlink" href="#inputs" title="Permalink to this headline"></a></h2>
<div class="line-block">
<div class="line">User inputs are gathered with the InputDevice class and the TryGetFeature. This allows inputs to be tested anywhere in the project.</div>
</div>
<div class="highlight-c# notranslate"><div class="highlight"><pre><span></span><span class="linenos">152</span><span class="c1">// Get right controller buttons states</span>
<span class="linenos">153</span><span class="kt">bool</span> <span class="n">primaryButtonState</span> <span class="p">=</span> <span class="n">VRInput</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">VRInput</span><span class="p">.</span><span class="n">primaryController</span><span class="p">,</span> <span class="n">CommonUsages</span><span class="p">.</span><span class="n">primaryButton</span><span class="p">);</span>
<span class="linenos">154</span><span class="kt">bool</span> <span class="n">triggerState</span> <span class="p">=</span> <span class="n">VRInput</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">VRInput</span><span class="p">.</span><span class="n">primaryController</span><span class="p">,</span> <span class="n">CommonUsages</span><span class="p">.</span><span class="n">triggerButton</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../Advanced/Montage.html" class="btn btn-neutral float-left" title="Camera Montage &amp; Editing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Ubisoft.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>